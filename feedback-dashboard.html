<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feedback Dashboard - Trick List</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .btn-back {
            background: rgba(100, 100, 150, 0.5);
            color: #a0a0ff;
            border: 1px solid rgba(100, 100, 150, 0.7);
            padding: 10px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-back:hover {
            background: rgba(100, 100, 150, 0.7);
            border-color: rgba(100, 100, 150, 0.9);
        }
        
        h1 {
            font-size: 28px;
            font-weight: 600;
        }
        
        .user-info {
            text-align: right;
            font-size: 14px;
        }
        
        .user-info .name {
            font-weight: 600;
            color: #4ade80;
        }
        
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-logout {
            background: #ef4444;
            color: white;
            margin-top: 8px;
        }
        
        .btn-logout:hover {
            background: #dc2626;
        }
        
        .message {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .message.show {
            display: block;
        }
        
        .message.error {
            background: #7f1d1d;
            border: 1px solid #dc2626;
            color: #fca5a5;
        }
        
        .message.success {
            background: #1f2937;
            border: 1px solid #4ade80;
            color: #86efac;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #4ade80;
        }
        
        .stat-label {
            font-size: 14px;
            color: #a0a0a0;
            margin-top: 8px;
        }
        
        .table-wrapper {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: rgba(255, 255, 255, 0.08);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: #4ade80;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        td {
            padding: 14px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 14px;
        }
        
        tbody tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }
        
        .type-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .type-badge.suggestion {
            background: rgba(59, 130, 246, 0.3);
            color: #93c5fd;
            border: 1px solid rgba(59, 130, 246, 0.5);
        }
        
        .type-badge.bug {
            background: rgba(239, 68, 68, 0.3);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.5);
        }
        
        .message-text {
            max-width: 400px;
            word-break: break-word;
        }
        
        .timestamp {
            font-size: 12px;
            color: #808080;
        }
        
        .email {
            font-size: 12px;
            color: #a0a0a0;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #a0a0a0;
        }
        
        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
        
        .empty {
            text-align: center;
            padding: 60px 20px;
            color: #606060;
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        .btn-delete {
            background: rgba(239, 68, 68, 0.3);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.5);
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-delete:hover {
            background: rgba(239, 68, 68, 0.6);
            border-color: rgba(239, 68, 68, 0.8);
        }
        
        .btn-delete:active {
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <button class="btn-back" onclick="goHome()">‚Üê Back to Home</button>
                <div>
                    <h1>üìã Feedback Dashboard</h1>
                </div>
            </div>
            <div class="user-info">
                <div class="name" id="userName">Loading...</div>
                <button class="btn btn-logout" onclick="logout()">Sign Out</button>
            </div>
        </header>
        
        <div id="message" class="message"></div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">Total Feedback</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="suggestionCount">0</div>
                <div class="stat-label">Suggestions</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="bugCount">0</div>
                <div class="stat-label">Bug Reports</div>
            </div>
        </div>
        
        <div class="table-wrapper">
            <div id="loading" class="loading">Loading feedback</div>
            <table id="feedbackTable" style="display: none;">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Message</th>
                        <th>From</th>
                        <th>Date</th>
                        <th style="width: 80px;">Action</th>
                    </tr>
                </thead>
                <tbody id="feedbackBody"></tbody>
            </table>
            <div id="empty" class="empty" style="display: none;">
                <div class="empty-icon">üì≠</div>
                <p>No feedback yet. Share your thoughts!</p>
            </div>
        </div>
    </div>
    
    <script src="owner-config.js"></script>
    <script src="fake-auth-v2.js"></script>
    <script>
        async function checkAuth() {
            try {
                // Get current user from localStorage
                const userStr = localStorage.getItem('tricklist_user');
                if (!userStr) {
                    showMessage('Please sign in first', 'error');
                    setTimeout(() => window.location.href = '/', 2000);
                    return null;
                }
                
                const user = JSON.parse(userStr);
                
                // Check if owner using local email check
                const OWNER_EMAIL = window.OWNER_EMAIL || 'owner@example.com';
                const isOwner = user.email && user.email.toLowerCase() === OWNER_EMAIL.toLowerCase();
                
                if (!isOwner) {
                    showMessage('Owner access only', 'error');
                    setTimeout(() => window.location.href = '/', 2000);
                    return null;
                }
                
                document.getElementById('userName').textContent = user.email.split('@')[0] + ' (Owner)';
                return user;
            } catch (e) {
                showMessage('Authentication error: ' + e.message, 'error');
                return null;
            }
        }
        
        async function loadFeedback() {
            try {
                // Load feedback from localStorage instead of API
                const feedbackStr = localStorage.getItem('tricklist_feedback') || '[]';
                const feedback = JSON.parse(feedbackStr);
                
                renderFeedback(feedback);
            } catch (e) {
                showMessage('Error: ' + e.message, 'error');
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        function renderFeedback(feedback) {
            const tbody = document.getElementById('feedbackBody');
            const table = document.getElementById('feedbackTable');
            const empty = document.getElementById('empty');
            
            // Update stats
            document.getElementById('totalCount').textContent = feedback.length;
            document.getElementById('suggestionCount').textContent = feedback.filter(f => f.type === 'suggestion').length;
            document.getElementById('bugCount').textContent = feedback.filter(f => f.type === 'bug').length;
            
            if (feedback.length === 0) {
                empty.style.display = 'block';
                table.style.display = 'none';
                return;
            }
            
            tbody.innerHTML = '';
            // Show newest first
            feedback.reverse().forEach((item, reversedIndex) => {
                const originalIndex = feedback.length - 1 - reversedIndex;
                const row = document.createElement('tr');
                const date = new Date(item.timestamp);
                const dateStr = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                row.innerHTML = `
                    <td><span class="type-badge ${item.type}">${item.type}</span></td>
                    <td><div class="message-text">${escapeHtml(item.message)}</div></td>
                    <td><div class="email">${escapeHtml(item.userEmail)}</div></td>
                    <td><div class="timestamp">${dateStr}</div></td>
                    <td><button class="btn-delete" onclick="deleteFeedback(${originalIndex})">‚úï Done</button></td>
                `;
                tbody.appendChild(row);
            });
            
            table.style.display = 'table';
            empty.style.display = 'none';
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'message show ' + type;
            setTimeout(() => msg.classList.remove('show'), 5000);
        }
        
        function logout() {
            localStorage.removeItem('tricklist_user');
            window.location.href = '/';
        }
        
        function goHome() {
            window.location.href = '/';
        }
        
        async function deleteFeedback(index) {
            if (!confirm('Mark this feedback as done and delete it?')) return;
            
            try {
                // Load from localStorage
                const feedbackStr = localStorage.getItem('tricklist_feedback') || '[]';
                const feedback = JSON.parse(feedbackStr);
                
                // Remove the item at index
                feedback.splice(index, 1);
                
                // Save back to localStorage
                localStorage.setItem('tricklist_feedback', JSON.stringify(feedback));
                
                loadFeedback();
            } catch (e) {
                showMessage('Error: ' + e.message, 'error');
            }
        }
        
        // Initialize
        window.addEventListener('DOMContentLoaded', async () => {
            const user = await checkAuth();
            if (user) {
                loadFeedback();
            }
        });
    </script>
</body>
</html>
